# ADR-003: Идентификаторы (payment_id, fee_id, fee_payment_id)
Статус: Accepted
Дата: 2025-08-22

## Контекст
Нужны стабильные ID для связки доменных сущностей, отчётности и идемпотентности.

## Решение
- payment_id (обязательство): `user_id_from:index:user_id_to:sum`.
- fee_id (подписка): `user_id:{period_start}:{amount}:{period_end}` (строка, уникальна).
- fee_payment_id: внешний ID платежа у платёжной системы (строка).
- (Рекомендовано) fees.payment_id (FK → payments.id) для внутренней трассировки.

## Последствия
+ Прозрачные и детерминированные ID; удобные джойны fees ↔ payments.
− Нужны валидаторы формата.

## План внедрения
Миграции для fees (unique fee_id, столбец fee_payment_id, FK payment_id). Обновить сервисы генерации ID.

## Тест-план
Юнит-тесты генерации/парсинга ID, уникальность fee_id, связка fee ↔ payment.
